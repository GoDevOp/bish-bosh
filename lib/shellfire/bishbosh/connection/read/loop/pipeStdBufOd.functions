core_usesIn bishbosh/connection/read/byte pipeStdbufOd

bishbosh_connection_read_loop_pipeStdbufOd_initialise()
{
	if core_compatibility_whichNoOutput stdbuf; then
		if core_compatibility_whichNoOutput od; then
			if od --version 2>&1 | grep -q '^od (GNU coreutils) '; then
				return 0
			fi
		fi
	fi
	return 1
}

_bishbosh_connection_read_loop_pipeStdbufOd_internal()
{
	local pathToStdbuf="$1"
	local pathToOd="$2"
	shift 2
	
	"$pathToStdbuf" -i 0 -o 0 -e 0 "$pathToOd" -A n -t u1 -w1 -v "$bishbosh_connection_fromServerFifo" >"$bishbosh_connection_fromHexConversionFifo" &
	core_children_killOnExit $!
	
	{
		bishbosh_connection_read_expectingCONNACK
		
		while $bishbosh_connection_continue
		do
			bishbosh_connection_body
		done
		
	} <"$bishbosh_connection_fromHexConversionFifo"
}

bishbosh_connection_read_loop_pipeStdbufOd()
{
	_bishbosh_connection_read_loop_pipeStdbufOd_internal stdbuf od
}
