core_usesIn bishbosh/connection error
core_dependency_requires '*' rm
bishbosh_connection_read_controlpacket_PUBREL()
{
	bishbosh_connection_error_ifRemainingLengthNot PUBREL 2
	
	local packetIdentifier
	bishbosh_connection_read_packetIdentifier
	
	local messageFileBasePath="$bishbosh_connection_sessionReceivePath"/2/$packetIdentifier
	local unknownPacketIdentifier
	if [ -f "$messageFileBasePath".sent-pubrec ]; then
		unknownPacketIdentifier=0
	else
		unknownPacketIdentifier=1
		printf '' >"$messageFileBasePath".sent-pubrec
	fi
	
	bishbosh_connection_handler_PUBREL
	
	bishbosh_connection_write_packetIdentifier=$packetIdentifier
	bishbosh_connection_write_PUBCOMP
	
	set +f
	rm -rf "$messageFileBasePath".* 2>/dev/null
	set -f
}
