core_usesIn bishbosh/connection error
core_dependency_requires '*' mv touch
bishbosh_connection_read_controlpacket_PUBREC()
{
	bishbosh_connection_error_ifRemainingLengthNot PUBREC 2
	
	local packetIdentifier
	bishbosh_connection_read_packetIdentifier

	local pendingSendQoS2PacketIdentifierPath="$bishbosh_connection_sessionPublicationsQoS2PendingSendPath"/"$packetIdentifier"
	local pendingCompQoS2PacketIdentifierPath="$bishbosh_connection_sessionPublicationsQoS2PendingCompPath"/"$packetIdentifier"
	if [ -f "$pendingCompQoS2PacketIdentifierPath" ]; then
		bishbosh_connection_error_any $core_commandLine_exitCode_SOFTWARE "read:PUBREC:Packet identifier $packetIdentifier already exists at pendingCompQoS2PacketIdentifierPath '$pendingCompQoS2PacketIdentifierPath'. How?"
	fi
	
	if [ -f "$pendingSendQoS2PacketIdentifierPath" ]; then
		unknownPacketIdentifier=0
		mv "$pendingSendQoS2PacketIdentifierPath" "$pendingCompQoS2PacketIdentifierPath"
	else
		unknownPacketIdentifier=1
		touch "$pendingCompQoS2PacketIdentifierPath"
	fi
	
	bishbosh_connection_handler_PUBREC

	bishbosh_connection_write_PUBREL_packetIdentifier=$packetIdentifier
	bishbosh_connection_write_PUBREL
}
