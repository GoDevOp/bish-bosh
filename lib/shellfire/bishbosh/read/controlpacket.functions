bishbosh_read_controlpacket_initialise()
{
	local isServer="$1"
	if core_variable_isTrue "$isServer"; then
		bishbosh_read_controlpacket_CONNACK()
		{
			bishbosh_read_controlpacket_invalid
		}
		bishbosh_read_controlpacket_SUBACK()
		{
			bishbosh_read_controlpacket_invalid
		}
		bishbosh_read_controlpacket_UNSUBACK()
		{
			bishbosh_read_controlpacket_invalid
		}
		bishbosh_read_controlpacket_PINGRESP()
		{
			bishbosh_read_controlpacket_invalid
		}
	else
		bishbosh_read_controlpacket_CONNECT()
		{
			bishbosh_read_controlpacket_invalid
		}
		bishbosh_read_controlpacket_SUBSCRIBE()
		{
			bishbosh_read_controlpacket_invalid
		}
		bishbosh_read_controlpacket_UNSUBSCRIBE()
		{
			bishbosh_read_controlpacket_invalid
		}
		bishbosh_read_controlpacket_PINGREQ()
		{
			bishbosh_read_controlpacket_invalid
		}
		bishbosh_read_controlpacket_DISCONNECT()
		{
			bishbosh_read_controlpacket_invalid
		}
	fi
}

bishbosh_read_controlpacket_next()
{
	local controlPacketByte
	local firstRemainingLengthByte
	
	read -r 
	
	bishbosh_read_od_nextTwoBytes
	
	case $controlPacketByte in
		
		16)
			# Only valid for servers
			bishbosh_read_controlpacket_CONNECT
		;;
		
		32)
			# Only valid for clients
			bishbosh_read_controlpacket_CONNACK
		;;
		
		48)
			bishbosh_read_controlpacket_PUBLISH_0
		;;
		
		49)
			bishbosh_read_controlpacket_PUBLISH_1
		;;
		
		50)
			bishbosh_read_controlpacket_PUBLISH_2
		;;
		
		51)
			bishbosh_read_controlpacket_PUBLISH_3
		;;
		
		52)
			bishbosh_read_controlpacket_PUBLISH_4
		;;
		
		53)
			bishbosh_read_controlpacket_PUBLISH_5
		;;
		
		54)
			bishbosh_read_controlpacket_PUBLISH_6
		;;
		
		55)
			bishbosh_read_controlpacket_PUBLISH_7
		;;
		
		56)
			bishbosh_read_controlpacket_PUBLISH_8
		;;
		
		57)
			bishbosh_read_controlpacket_PUBLISH_9
		;;
		
		58)
			bishbosh_read_controlpacket_PUBLISH_10
		;;
		
		59)
			bishbosh_read_controlpacket_PUBLISH_11
		;;
		
		60)
			bishbosh_read_controlpacket_PUBLISH_12
		;;
		
		61)
			bishbosh_read_controlpacket_PUBLISH_13
		;;
		
		62)
			bishbosh_read_controlpacket_PUBLISH_14
		;;
		
		63)
			bishbosh_read_controlpacket_PUBLISH_15
		;;
		
		64)
			bishbosh_read_controlpacket_PUBACK
		;;
		
		80)
			bishbosh_read_controlpacket_PUBREC
		;;
		
		98)
			bishbosh_read_controlpacket_PUBREL
		;;
		
		112)
			bishbosh_read_controlpacket_PUBCOMP
		;;
		
		130)
			# Only valid for servers
			bishbosh_read_controlpacket_SUBSCRIBE
		;;
		
		144)
			# Only valid for clients
			bishbosh_read_controlpacket_SUBACK
		;;
		
		162)
			# Only valid for servers
			bishbosh_read_controlpacket_UNSUBSCRIBE
		;;
		
		176)
			# Only valid for clients
			bishbosh_read_controlpacket_UNSUBACK
		;;
		
		192)
			# Only valid for servers
			bishbosh_read_controlpacket_PINGREQ
		;;
		
		208)
			# Only valid for clients
			bishbosh_read_controlpacket_PINGRESP
		;;
		
		224)
			# Only valid for servers
			bishbosh_read_controlpacket_DISCONNECT
		;;
		
		*)
			bishbosh_read_controlpacket_invalid
		;;
	esac
}
